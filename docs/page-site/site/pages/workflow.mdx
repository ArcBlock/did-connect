---
layout: 'my-layout'
blocks:
  - name: SectionBlock
    background:
      color: '#fff'
    className: text-center
    classes:
      section: '!xl:py-10'
    title:
      - name: Pic
        className: w-[120px] m-auto mb-8
        src: /logos/logo-ico.png
      - name: div
        className: font-bold text-center
        children: DID Connect
    description:
      - name: div
        className: text-center text-[#333]
        children: Set up a blocklet app by running one command.
      - name: div
        className: text-center
        children:
          name: Button
          varaint: border
          className: mt-8 w-auto m-auto !text-#236FFF !border-#236FFF px-4 py-2 !inline-block
          size: lg
          color: primary
          children:
            name: SmartLink
            to: /getting-started
            base: docs
            children: Get Started
---

我们可以把完整的 DID Connect 过程称为 `DID Connect 会话`，会话过程中的参与方包括：

- User (Wallet): 管理用户的数字身份
- DApp (Blocklet): 需要用户提供特定信息以完成某些业务流程
- Relay (Service): 在 DID Connect 过程中维护会话的状态，中转并校验应用的请求和用户的响应

会话过程如下图所示：

TODO: 图片

每个步骤的动作如下：

1. 用户和应用交互时遇到需要提供数字身份、数据签名、交易签名、可验证声明、资产所有权证明、通行证等情况
2. 应用生成 DID Connect 会话，并将会话保存到 DID Connect Relay 中
3. 应用将 DID Connect Relay 的二维码呈现给用户，用户用钱包扫码
4. 应用在钱包扫码后用标准格式将需要用户提供的信息（Request List）保存到 DID Connect Relay 中
5. DID Wallet 拿到应用的 Request，解析并呈现给用户，在用户审查并同意后把响应（Response List）保存到 DID Connect Relay 中
6. 应用通过订阅或者轮训的方式拿到 DID Wallet 提供的信息，完成后续的业务流程

关于上述流程的额外说明：

- 步骤 4 是可选的，应用可以在会话创建的时候提供一个 API，DID Connect Relay 在钱包扫码时请求该 API 获取 Request List
- 步骤 4 合并和步骤 2 是分开的，以满足应用在某些情况下知道用户身份之后才能精确确定需要用户提供的信息，比如必须提供某个账户下面的通行证
- 步骤 5 中用户可以在钱包中选择拒绝，拒绝时应用也会收到通知，并可执行相应的回调
- 为了良好的用户体验，DID Connect 会话过程中的大部分等待都有超时机制

### State Machine

用状态机来描述 `DID Connect 会话`的完整过程再合适不过了：

https://stately.ai/viz/98beeb99-5b56-4c3f-9743-3250bac3ec50

<iframe
  src="https://stately.ai/viz/embed/98beeb99-5b56-4c3f-9743-3250bac3ec50?mode=viz&panel=code&showOriginalLink=1&readOnly=1&pan=0&zoom=1&controls=1"
  sandbox="allow-same-origin allow-scripts"></iframe>

正常情况下，成功的 `DID Connect 会话` 的完整状态变化顺序为：

- start
- loading
- created
- walletScanned
- walletConnected
- appConnected
- walletApproved
- appApproved
- completed
